{% extends 'core/base.html' %}
{% load static %}
{%  block extrahead %}
    <script defer src="{% static 'js/core/helpers.js' %}"></script>
    <script async type="module" src="{% static 'js/users/profile.js' %}"></script>
{% endblock %}
{% block title %}Profil - {{ user.nickname }} - Epróba{% endblock %}
{% block content %}
    {% load socialaccount %}
    <div class="box" style="position:relative; width:100%;">
        <h1 class="subtitle">Informacje publiczne</h1>
        <table class="table">
            <tr>
                <td>Imię</td>
                {% if user.first_name != null %}
                    <td>
                        <p>{{ user.first_name }}</p>
                    </td>
                {% else %}
                    <td>
                        <p><i>Nie podano</i></p>
                    </td>
                {% endif %}
            </tr>
            <tr>
                <td>Nazwisko</td>
                {% if user.last_name != null %}
                    <td>
                        <p>{{ user.last_name }}</p>
                    </td>
                {% else %}
                    <td>
                        <p><i>Nie podano</i></p>
                    </td>
                {% endif %}
            </tr>
            <tr>
                <td>Pseudonim</td>
                <td>
                    <p>
                        {{ user.nickname }}
                    </p>
                </td>
            </tr>
            <tr>
                <td>Stopień</td>
                <td>
                    <p>
                        {{ user.rank }}
                    </p>
                </td>
            </tr>
            <tr>
                <td>Okręg</td>
                <td>
                    <p>
                        {{ user.patrol.team.district }}
                    </p>
                </td>
            </tr>
            <tr>
                <td>Drużyna</td>
                <td>
                    <p>
                        {{ user.patrol.team }}
                        {% if user.function == 4 %} - <b>Drużynowy(-a)</b>{% endif %}
                        {% if user.function == 3 %} - <b>Przyboczny(-a)</b>{% endif %}
                    </p>
                </td>
            </tr>
            <tr>
                <td>Zastęp</td>
                <td>
                    <p>
                        {{ user.patrol }}
                        {% if user.function == 2 %} - <b>Zastępowy(-a)</b>{% endif %}
                        {% if user.function == 1 %} - <b>Podzastępowy(-a)</b>{% endif %}
                    </p>
                </td>
            </tr>
        </table>
    </div>
    {% if allow_edit %}
        {% load provider_ids %}
        {% load invert %}
        <div class="box" style="position:relative; width:100%;">
            <h1 class="subtitle">Informacje prywatne</h1>
            <table class="table">
                <tr>
                    <td>Email</td>
                    <td>
                        <p>{{ user.email }}</p>
                    </td>
                </tr>
            </table>
        </div>

        <div class="box" style="position:relative; width:100%;">
            <a href="{% url 'edit_profile' user.id %}">
                <button class="button is-primary is-light">
                    <span class="icon"><i class="fas fa-user-edit"></i></span><span>Edytuj profil</span>
                </button>
            </a>
            {% if user.has_usable_password %}
                <a href="{% url 'change_password' user.id %}">
                    <button class="button is-success is-light">
                        <span class="icon"><i class="fas fa-key"></i></span><span>Zmień hasło</span>
                    </button>
                </a>
            {% else %}
                <a href="{% url 'set_password' user.id %}">
                    <button class="button is-success is-light">
                        <span class="icon"><i class="fas fa-key"></i></span><span>Ustaw hasło</span>
                    </button>
                </a>
            {% endif %}
            {% get_social_accounts user as accounts %}
            {% get_providers as socialaccount_providers %}
            {% if "google" in socialaccount_providers|ids %}
                {% if not accounts.google %}
                    <a href="/accounts/google/login/?process=connect">
                        <button class="button is-danger is-outlined">
                            <span class="icon"><i class="fab fa-google"></i></span><span>Połącz z Google</span>
                        </button>
                    </a>
                {% else %}
                    <a onclick="confirm_popup('{% url 'disconnect_socials' 'google' %}', 'Czy na pewno chcesz odłączyć konto Google™?')">
                        <button class="button is-danger is-light">
                            <span class="icon"><i class="fab fa-google"></i></span><span>Połączono z Google</span>
                        </button>
                    </a>
                {% endif %}
            {% endif %}
            {% if "facebook" in socialaccount_providers|ids %}
                {% if not accounts.facebook %}
                    <a href="/accounts/facebook/login/?process=connect">
                        <button class="button is-info is-outlined">
                            <span class="icon"><i class="fab fa-facebook"></i></span><span>Połącz z Facebook</span>
                        </button>
                    </a>
                {% else %}
                    <a onclick="confirm_popup('{% url 'disconnect_socials' 'facebook' %}', 'Czy na pewno chcesz odłączyć konto Facebook™?')">
                        <button class="button is-info is-light">
                            <span class="icon"><i class="fab fa-facebook"></i></span><span>Połączono z Facebook</span>
                        </button>
                    </a>
                {% endif %}
            {% endif %}
        </div>
        <div class="box" id="notifications_devices" style="position:relative; width:100%;">
            <div>
                <h1 class="subtitle">Powiadomienia</h1>
                <div style="display: flex; flex-wrap: wrap;">
                    {% for device in user.fcmdevice_set.all %}
                        <div class="card" style="max-width: 220px; margin-right: 1rem" data-registration_id="{{ device.registration_id }}" data-device-info="{{ device.name }}">
                          <div class="card-image">
                            <figure class="image is-256x256">
                              <img src="https://faisalman.github.io/ua-parser-js/images/types/default.png" alt="Placeholder image">
                            </figure>
                          </div>
                          <div class="card-content">
                            <div class="media">
                              <div class="media-left">
                                <figure class="image is-48x48">
                                  <img src="https://faisalman.github.io/ua-parser-js/images/browsers/default.png" alt="Placeholder image">
                                </figure>
                              </div>
                              <div class="media-content">
                                <p class="title is-6"></p>
                                <p class="subtitle is-7" style="margin-bottom: 0"></p>
                                <div class="content" id="that-device"></div>
                              </div>
                            </div>

                            <div class="content" id="content">
                                <p class="subtitle is-7">Status:</p>
                                <span class="has-tooltip-left has-tooltip-arrow" data-tooltip="{% if device.active %}Wyłącz{% else %}Włącz{% endif %} powiadomienia na tym urządzeniu"><button class="button is-primary" style="margin-bottom: 1rem" id="active-button-{{ device.id }}" >{% if device.active %}Włączone{% else %}Wyłączone{% endif %}</button></span><br>
                                <p class="subtitle is-7">Akcje:</p>
                                <span class="has-tooltip-left has-tooltip-arrow has-tooltip-danger" data-tooltip="Usuń to urządzenie"><button class="button is-danger" id="delete-button-{{ device.id }}">Usuń</button></span><br>
                            </div>
                          </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
